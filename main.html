<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Welcome</title>
    <style>
      body {
        font-family: "Georgia", serif;
        margin: 0;
        padding: 0;
        background-color: #ffffff;
        color: #000000;
        overflow-x: hidden;
      }

      section {
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      /* Welcome section - keeping white background */
      #welcome {
        background-color: #ffffff;
      }

      .menu-container h1 {
        font-size: 3rem;
        font-weight: normal;
        margin: 0;
        position: absolute;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
      }

      .menu-container a {
        display: inline-block;
        margin: 10px 0;
        padding: 10px 20px;
        font-size: 1.2rem;
        color: #000000;
        text-decoration: none;
        border: 2px solid #000000;
        border-radius: 5px;
        transition: all 0.3s ease;
      }

      .menu-container a:hover {
        background-color: #000000;
        color: #ffffff;
      }

      /* Age Calculator section - light warm background */
      .age-calculator {
        width: 100%;
        background-color: #f5f3f0;
        text-align: center;
        padding: 20px;
      }

      /* Category Checker section - light cool background */
      .category-checker {
        width: 100%;
        background-color: #d8e4e8;
        text-align: center;
        padding: 20px;
      }

      .age-calculator h2,
      .category-checker h2 {
        font-size: 2rem;
        margin-bottom: 20px;
      }

      form {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .input-group {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 15px;
      }

      .input-group div {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      input,
      select {
        margin: 5px;
        padding: 10px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 200px;
      }

      button {
        margin-top: 10px;
        padding: 10px 20px;
        font-size: 1rem;
        color: #ffffff;
        background-color: #000000;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      button:hover {
        background-color: #444444;
      }

      #result,
      #category-result {
        font-family: "Courier New", monospace;
        font-size: 1.5rem;
      }

      .bold-number {
        font-weight: bold;
      }

      /* PDF Search section - light purple background */
      .pdf-search {
        width: 100%;
        background-color: #e1cdc1;
        text-align: center;
        padding: 20px;
      }

      .pdf-search h2 {
        font-size: 2rem;
        margin-bottom: 20px;
      }

      #search-results {
        margin-top: 20px;
        padding: 20px;
        text-align: left;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      /* PDF Search section styles */
      .pdf-list {
        list-style: none;
        padding: 0;
      }

      .pdf-item {
        padding: 15px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f8f9fa;
      }

      .pdf-item a {
        color: #1a73e8;
        text-decoration: none;
        font-size: 16px;
      }

      .pdf-item a:hover {
        text-decoration: underline;
      }

      .search-container {
        margin: 20px 0;
        width: 80%;
        max-width: 800px;
      }

      .search-input {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: 2px solid #ddd;
        border-radius: 8px;
        box-sizing: border-box;
      }

      .search-input:focus {
        outline: none;
        border-color: #1a73e8;
      }

      .pdf-list-container {
        max-height: 50vh;
        width: 80%;
        max-width: 800px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        margin-top: 20px;
        scroll-behavior: smooth;
        scrollbar-width: thin;
        scrollbar-color: #1a73e8 #f1f1f1;
      }

      .pdf-list-container::-webkit-scrollbar {
        width: 8px;
      }

      .pdf-list-container::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
      }

      .pdf-list-container::-webkit-scrollbar-thumb {
        background: #1a73e8;
        border-radius: 4px;
      }

      .pdf-list-container::-webkit-scrollbar-thumb:hover {
        background: #1557b0;
      }
    </style>
    <button id="logout-button">Logout</button>
  </head>
  <body>
    <section id="welcome">
      <div class="menu-container">
        <h1>Xush kelibsiz, Abbos Nazarovich!</h1>
        <div style="margin-top: 120px">
          <a href="#age-calculator" id="ageCalculatorLink"
            >Bitirish Kalkulyatori</a
          >
          <a href="#category-checker" id="categoryCheckerLink"
            >Toifa Tekshiruvchisi</a
          >
          <a href="#pdf-search" id="pdfSearchLink">PDF Qidirish</a>
        </div>
      </div>
    </section>

    <section id="age-calculator" class="age-calculator">
      <h2>Bitirish Kalkulyatori</h2>
      <form onsubmit="calculateGraduationAge(event)">
        <div class="input-group">
          <div>
            <label for="dob-date">Boshlanish sanasi</label>
            <input type="date" id="dob-date" required />
          </div>
          <div>
            <label for="grad-date">Tugash sanasi</label>
            <input type="date" id="grad-date" required />
          </div>
        </div>
        <button type="submit">Hisoblash</button>
        <button type="button" onclick="clearFields()">Tozalash</button>
      </form>
      <p id="result"></p>
    </section>

    <section id="category-checker" class="category-checker">
      <h2>Toifa Tekshiruvchisi</h2>
      <br />
      <br />
      <form onsubmit="checkCategory(event)">
        <div class="input-group">
          <div>
            <label for="start-date">Boshlanish sanasi</label>
            <input type="date" id="start-date" required />
          </div>
          <div>
            <label for="end-date">Tugash sanasi</label>
            <input type="date" id="end-date" required />
          </div>
        </div>
        <label for="category">Toifani tanlang</label>
        <select id="category" required>
          <option value="A">Toifa A</option>
          <option value="B">Toifa B</option>
          <option value="C">Toifa C</option>
          <option value="B and C">Toifa B va C</option>
        </select>
        <button type="submit">Tekshirish</button>
        <button type="button" onclick="clearFields()">Tozalash</button>
      </form>
      <p id="category-result"></p>

      <h3>Toifa ma'lumotlari</h3>
      <table
        border="1"
        style="
          margin: 20px auto;
          border-collapse: collapse;
          width: 40%;
          height: 20%;
          text-align: center;
        "
      >
        <thead>
          <tr>
            <th>Toifa</th>
            <th>Talab qilingan kunlar</th>
            <th>Talab qilingan haftalar</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A</td>
            <td>63 kun</td>
            <td>9 hafta</td>
          </tr>
          <tr>
            <td>B</td>
            <td>126 kun</td>
            <td>18 hafta</td>
          </tr>
          <tr>
            <td>C</td>
            <td>154 kun</td>
            <td>22 hafta</td>
          </tr>
          <tr>
            <td>B va C</td>
            <td>168 kun</td>
            <td>24 hafta</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section id="pdf-search" class="pdf-search">
      <h2>PDF Qidirish</h2>
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          id="searchInput"
          placeholder="PDF fayllarni qidirish..."
        />
      </div>
      <div class="pdf-list-container">
        <ul class="pdf-list" id="pdfList">
          <li class="pdf-item">PDF ro'yxati yuklanmoqda...</li>
        </ul>
      </div>
    </section>

    <script>
      function clearFields() {
        // Clear date inputs
        document.getElementById("start-date").value = "";
        document.getElementById("end-date").value = "";
        document.getElementById("dob-date").value = "";
        document.getElementById("grad-date").value = "";
        // Add clearing for search field
        document.getElementById("searchInput").value = "";
        document.getElementById("pdfList").innerHTML =
          "<li class=\"pdf-item\">PDF ro'yxatini yuklashda xatolik yuz berdi. Iltimos, keyinroq qayta urinib ko'ring.</li>";
      }

      // Smooth Scroll Function
      document
        .getElementById("ageCalculatorLink")
        .addEventListener("click", function (event) {
          event.preventDefault();
          const target = document.getElementById("age-calculator");

          window.scrollTo({
            top: target.offsetTop,
            behavior: "smooth",
          });
        });

      document
        .getElementById("categoryCheckerLink")
        .addEventListener("click", function (event) {
          event.preventDefault();
          const target = document.getElementById("category-checker");

          window.scrollTo({
            top: target.offsetTop,
            behavior: "smooth",
          });
        });

      function calculateGraduationAge(event) {
        event.preventDefault();

        // const dobDay = parseInt(document.getElementById("dob-day").value);
        // const dobMonth = parseInt(document.getElementById("dob-month").value);
        // const dobYear = parseInt(document.getElementById("dob-year").value);

        // const gradDay = parseInt(document.getElementById("grad-day").value);
        // const gradMonth = parseInt(document.getElementById("grad-month").value);
        // const gradYear = parseInt(document.getElementById("grad-year").value);

        const dob = new Date(document.getElementById("dob-date").value);
        const gradDate = new Date(document.getElementById("grad-date").value);

        if (dob > gradDate) {
          document.getElementById("result").innerHTML =
            "Bitirish sanasi tug'ilgan sanadan oldin bo'lishi mumkin emas!";
          return;
        }

        let ageYears = gradDate.getFullYear() - dob.getFullYear();
        let ageMonths = gradDate.getMonth() - dob.getMonth();

        if (ageMonths < 0) {
          ageYears--;
          ageMonths += 12;
        }

        document.getElementById(
          "result"
        ).innerHTML = `Siz bitirganingizda <span class="bold-number">${ageYears}</span> yosh va <span class="bold-number">${ageMonths}</span> oylik edingiz.`;
      }

      function checkCategory(event) {
        event.preventDefault();

        const startDate = new Date(document.getElementById("start-date").value);
        const endDate = new Date(document.getElementById("end-date").value);
        const category = document.getElementById("category").value;

        if (startDate > endDate) {
          document.getElementById("category-result").innerHTML =
            "Tugash sanasi boshlanish sanasidan oldin bo'lishi mumkin emas!";
          return;
        }

        const daysStudied = (endDate - startDate) / (1000 * 60 * 60 * 24);
        const weeksStudied = (daysStudied / 7).toFixed(2);

        let isValid = false;
        let daysNeed = 0;
        let weeksNeed = 0;

        switch (category) {
          case "A":
            isValid = daysStudied >= 63 || weeksStudied >= 9;
            daysNeed = 63;
            weeksNeed = 9;
            break;
          case "B":
            isValid = daysStudied >= 126 || weeksStudied >= 18;
            daysNeed = 126;
            weeksNeed = 18;
            break;
          case "C":
            isValid = daysStudied >= 154 || weeksStudied >= 22;
            daysNeed = 154;
            weeksNeed = 22;
            break;
          case "B and C":
            isValid = daysStudied >= 168 || weeksStudied >= 24;
            daysNeed = 168;
            weeksNeed = 24;
            break;
        }

        if (isValid) {
          document.getElementById(
            "category-result"
          ).innerHTML = `Tabriklaymiz! Siz <span class="bold-number">${category}</span> toifa talablariga javob berasiz. 
                        <br><br>Siz <span class="bold-number">${weeksStudied} hafta</span> yoki <span class="bold-number">${daysStudied} kun</span> o'qidingiz. 
                        <br><span class="bold-number">${category}</span> toifani yakunlash uchun <span class="bold-number">${weeksNeed} hafta</span> yoki <span class="bold-number">${daysNeed} kun</span> talab qilinadi.`;
        } else {
          document.getElementById(
            "category-result"
          ).innerHTML = `Afsuski, siz <span class="bold-number">${category}</span> toifa talablariga javob bermaysiz.
                        <br><br>Siz <span class="bold-number">${weeksStudied} hafta</span> yoki <span class="bold-number">${daysStudied} kun</span> o'qidingiz. 
                        <br><span class="bold-number">${category}</span> toifani yakunlash uchun <span class="bold-number">${weeksNeed} hafta</span> yoki <span class="bold-number">${daysNeed} kun</span> talab qilinadi.`;
        }
      }

      // Add smooth scroll for PDF Search
      document
        .getElementById("pdfSearchLink")
        .addEventListener("click", function (event) {
          event.preventDefault();
          const target = document.getElementById("pdf-search");

          window.scrollTo({
            top: target.offsetTop,
            behavior: "smooth",
          });
        });

      const FOLDER_ID = "1p5I-rIRTY57fswogu6f62UHIldcZ_Rtu";
      let pdfFiles = []; // Store all PDF files

      fetch(
        `https://www.googleapis.com/drive/v3/files?q='${FOLDER_ID}'+in+parents+and+mimeType='application/pdf'&key=AIzaSyAWLDbxg2Ns__KZLWqQ7tICupqHUDZUlVA`
      )
        .then((response) => response.json())
        .then((data) => {
          pdfFiles = data.files;
          displayPDFs(pdfFiles);
        })
        .catch((error) => {
          document.getElementById("pdfList").innerHTML =
            "<li class=\"pdf-item\">PDF ro'yxatini yuklashda xatolik yuz berdi. Iltimos, keyinroq qayta urinib ko'ring.</li>";
          console.error("Error:", error);
        });

      function displayPDFs(files) {
        const pdfList = document.getElementById("pdfList");
        pdfList.innerHTML = "";

        if (files.length === 0) {
          pdfList.innerHTML =
            '<li class="pdf-item">Mos keladigan PDF fayllar topilmadi.</li>';
          return;
        }

        files.forEach((file) => {
          const li = document.createElement("li");
          li.className = "pdf-item";
          li.innerHTML = `<a href="https://drive.google.com/file/d/${file.id}/view" target="_blank">${file.name}</a>`;
          pdfList.appendChild(li);
        });
      }

      // Search functionality
      document.getElementById("searchInput").addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredFiles = pdfFiles.filter((file) =>
          file.name.toLowerCase().includes(searchTerm)
        );
        displayPDFs(filteredFiles);
      });
    </script>
    <script type="module" src="script.js"></script>
    <script type="module" src="welcome.js"></script>
  </body>
</html>
